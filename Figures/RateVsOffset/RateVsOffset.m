%% Automate Importing Data by Generating Code Using the Database Explorer App
% This code reproduces the data obtained using the Database Explorer app by
% connecting to a database, executing a SQL query, and importing data into the
% MATLAB(R) workspace. To use this code, add the password for connecting to the
% database in the database command.

% Auto-generated by MATLAB Version 9.5 (R2018b) and Database Toolbox Version 9.0 on 05-Aug-2019 13:28:07

%% Make connection to database
conn = database('rockmodeling','Yoni','Yoni','com.mysql.jdbc.Driver','jdbc:mysql://localhost:3306/rockmodeling?useSSL=false&');

%% Execute query and fetch results
data = fetch(conn,['SELECT ' ...
    '    Orientation, NumGrains, AVG(Rate) AS Rate, std(Rate) AS Std ' ...
    'FROM ' ...
    '    (SELECT ' ...
    '        m._id, ' ...
    '            m.Orientation, ' ...
    '            m.NumGrains, ' ...
    '            tf.TotalDissolution / tf.NumOfSteps AS Rate ' ...
    '    FROM ' ...
    '        models AS m ' ...
    '    JOIN models_info AS mi ON mi.modelid = m._id ' ...
    '    JOIN totaldissolutiononStabilizedsteps AS tf ON tf.modelId = m._id ' ...
    '    WHERE ' ...
    '        m.Orientation != ''None'' ' ...
    '            AND m.RockType = 3 ' ...
    '            AND m.DoloPercent < 0.001 ' ...
    '            AND NumGrains IN (100 , 800, 1600) ' ...
    '    GROUP BY m._id , m.Orientation , m.NumGrains) AS t ' ...
    'GROUP BY Orientation , NumGrains ' ...
    'ORDER BY Orientation']);
%% Close connection to database
close(conn)

%% Clear variables
clear conn


%% Plotting
figure;
i = 1;
Y = [];
Err = [];
for NumGrain = unique(data.NumGrains)'
    Indexes = (data.NumGrains == NumGrain);
    Rates = data.Rate(Indexes);
    Errors = data.Std(Indexes);
    Y = [Y Rates];
    Err = [Err Errors];
    i = i+1;
end
X1 = cellfun(@str2num,data.Orientation(Indexes))*100;
createfigure4(X1,Y(:,1),Y(:,2),Y(:,3),Err(:,1),Err(:,2),Err(:,3))

